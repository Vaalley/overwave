[gd_scene load_steps=5 format=3 uid="uid://c8canohv7airc"]

[sub_resource type="GDScript" id="GDScript_h8ojn"]
script/source = "extends CanvasLayer

@export var all_upgrades: Array

@onready var button1 = $VBoxContainer/Button
@onready var button2 = $VBoxContainer/Button2
@onready var button3 = $VBoxContainer/Button3


func _ready():
	# ExperienceManager.level_up.connect(_on_level_up)
	button1.pressed.connect(_on_choice_made.bind(button1))
	button2.pressed.connect(_on_choice_made.bind(button2))
	button3.pressed.connect(_on_choice_made.bind(button3))


func _on_level_up(_new_level):
	get_tree().paused = true
	self.visible = true

	all_upgrades.shuffle()
	var choices = all_upgrades.slice(0, 2)
	
	button1.text = choices[0].name
	button2.text = choices[1].name
	#button3.text = choices[2].name
	
	button1.set_meta(\"upgrade\", choices[0])
	button2.set_meta(\"upgrade\", choices[1])
	#button3.set_meta(\"upgrade\", choices[2])


func _on_choice_made(button_pressed: Button):
	var upgrade_chosen: UpgradeData = button_pressed.get_meta(\"upgrade\")
	
	get_tree().get_first_node_in_group(\"Player\").apply_upgrade(upgrade_chosen)
	
	get_tree().paused = false
	self.visible = false
"

[sub_resource type="GDScript" id="GDScript_adbc8"]
script/source = "extends Resource
class_name UpgradeData

enum UpgradeType { PLAYER_SPEED, ATTACK_SPEED }

@export var name: String
@export_multiline var description: String
@export var type: UpgradeType
@export var value: float
"

[sub_resource type="Resource" id="Resource_scxlh"]
script = SubResource("GDScript_adbc8")
name = "Rapid Fire"
description = "Fire 10% faster."
type = 1
value = 0.9
metadata/_custom_type_script = "uid://co5ptavqlsk7p"

[sub_resource type="Resource" id="Resource_ovwte"]
script = SubResource("GDScript_adbc8")
name = "Speed Boost"
description = "Move 15% faster."
value = 15.0
metadata/_custom_type_script = "uid://co5ptavqlsk7p"

[node name="UpgradeScreen" type="CanvasLayer"]
process_mode = 3
visible = false
script = SubResource("GDScript_h8ojn")
all_upgrades = [SubResource("Resource_scxlh"), SubResource("Resource_ovwte")]

[node name="ColorRect" type="ColorRect" parent="."]
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
color = Color(0, 0, 0, 0.5882353)

[node name="VBoxContainer" type="VBoxContainer" parent="."]
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -20.0
offset_top = -20.0
offset_right = 20.0
offset_bottom = 20.0
grow_horizontal = 2
grow_vertical = 2

[node name="Button" type="Button" parent="VBoxContainer"]
layout_mode = 2
text = "Upgrade 1"

[node name="Button2" type="Button" parent="VBoxContainer"]
layout_mode = 2
text = "Upgrade 2"

[node name="Button3" type="Button" parent="VBoxContainer"]
layout_mode = 2
text = "Upgrade 3"
